---
phase: 15-slack-ai-assistant-experience
plan: 07
type: execute
wave: 6
depends_on: ["15-06"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "App compiles and starts without errors"
    - "Existing channel watching and ephemeral delivery works as before"
    - "Assistant panel opens and shows welcome message with suggested prompts"
    - "User can type in assistant panel and receive streaming AI suggestion"
    - "Feedback buttons appear on assistant suggestions"
    - "DM suggestions work through the assistant panel"
  artifacts: []
  key_links: []
---

<objective>
Verify the complete AI Assistant experience works across all conversation types and confirm zero regression in existing functionality.

Purpose: End-to-end verification ensures all plans integrate correctly and no existing functionality is broken.
Output: Verified, working AI assistant experience with backward-compatible ephemeral delivery.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/15-slack-ai-assistant-experience/15-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build verification and static analysis</name>
  <files></files>
  <action>
1. Run full build:
   ```
   npm run build --workspaces --if-present
   ```
   All packages must compile with zero TypeScript errors.

2. Run tests (if available):
   ```
   npm test --workspace=@slack-speak/slack-backend
   ```
   All existing tests must pass. If tests fail due to Bolt v4 mock changes, note the failures but do not block on them (they indicate mock updates needed, not feature regressions).

3. Verify assistant file structure:
   ```
   ls -R apps/slack-backend/src/assistant/
   ```
   Expected:
   - assistant.ts
   - streaming.ts
   - feedback.ts
   - suggested-prompts.ts
   - handlers/thread-started.ts
   - handlers/thread-context.ts
   - handlers/user-message.ts
   - actions/index.ts
   - actions/feedback-handler.ts
   - actions/send-from-assistant.ts
   - actions/refine-from-assistant.ts
   - actions/dismiss-from-assistant.ts

4. Verify all registrations in app.ts:
   - `app.assistant(assistant)` — assistant registered
   - `registerAssistantActions(app)` — action handlers registered
   - All existing handler registrations unchanged

5. Verify manifest has:
   - `assistant:write` scope
   - `assistant_thread_started` event
   - `assistant_thread_context_changed` event

6. Verify schema has `assistantDelivery` column in users table.

7. Verify no breaking changes to existing files:
   - `suggestion-delivery.ts` — exports unchanged
   - `ai.ts` — `generateSuggestion` still exported and unchanged
   - `workers.ts` — YOLO mode and response_url branches unchanged
   - `message-reply.ts` — unchanged
   - `app-mention.ts` — unchanged
  </action>
  <verify>
`npm run build --workspaces --if-present` succeeds. All handler registrations verified. File structure complete.
  </verify>
  <done>
Full build passes. All assistant files present. All registrations verified. No regressions in existing handler patterns.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete AI Assistant experience with streaming responses, context awareness, feedback buttons, and action buttons. Existing ephemeral delivery preserved for channel watchers.</what-built>
  <how-to-verify>
Test the following scenarios (requires the app to be running with `npm run dev --workspace=slack-backend` and connected to a Slack workspace):

**1. Assistant Panel Opens:**
- Open Slack, find the Speak for Me app in the top nav or app list
- Click to open the assistant panel
- Verify: Welcome message appears ("Hi! I'm Speak for Me...")
- Verify: Suggested prompts appear below the welcome message (3-4 context-aware prompts)

**2. Streaming Response:**
- Type a message in the assistant panel (e.g., "Help me respond to a colleague who keeps missing deadlines")
- Verify: "thinking..." status appears briefly
- Verify: Response streams in progressively (not all at once)
- Verify: Feedback buttons (thumbs up/down) appear after response completes
- Verify: Action buttons (Send as Me, Refine, Dismiss) appear after the response

**3. Context Awareness:**
- While in the assistant panel, navigate to a specific channel in Slack
- Type a message in the assistant panel asking about that channel
- Verify: The assistant references context from the channel you are viewing

**4. Feedback Buttons:**
- Click thumbs up or thumbs down on a suggestion
- Verify: No error occurs, button interaction is acknowledged

**5. Dismiss:**
- Click "Dismiss" on a suggestion
- Verify: Dismissal acknowledged, suggestion tracked

**6. Backward Compatibility (CRITICAL):**
- Go to a channel where you have /watch active
- Have another user (or test user) post a message in that channel
- Verify: You receive an ephemeral suggestion in the channel (NOT in the assistant panel)
- Verify: The ephemeral suggestion has the existing buttons (Send as Me, Refine, Dismiss)

**7. DM Scenario:**
- Open a DM with another user
- Open the assistant panel while viewing that DM
- Type a request in the assistant panel
- Verify: Response streams with context from the DM conversation

If any of these fail, describe the issue and which step failed.
  </how-to-verify>
  <resume-signal>Type "approved" if all scenarios pass, or describe which scenarios failed and any error details.</resume-signal>
</task>

</tasks>

<verification>
1. Full build succeeds across all workspaces
2. Existing tests pass (or failures are clearly Bolt mock-related, not feature regressions)
3. Human verification confirms all 7 scenarios
</verification>

<success_criteria>
- App compiles and starts without errors
- Assistant panel opens with welcome message and prompts
- Streaming responses work in the assistant panel
- Feedback buttons track quality
- Action buttons (Send, Refine, Dismiss) work from panel
- Existing channel ephemeral delivery unchanged
- DM suggestions work through assistant panel
- Zero regression in existing functionality
</success_criteria>

<output>
After completion, create `.planning/phases/15-slack-ai-assistant-experience/15-07-SUMMARY.md`
</output>
