---
phase: 15-slack-ai-assistant-experience
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - slack-app-manifest.yml
  - apps/slack-backend/src/app.ts
autonomous: false

must_haves:
  truths:
    - "Manifest includes assistant:write bot scope"
    - "Manifest subscribes to assistant_thread_started and assistant_thread_context_changed events"
    - "App constructor scopes array includes assistant:write"
  artifacts:
    - path: "slack-app-manifest.yml"
      provides: "Updated manifest with assistant scopes and events"
      contains: "assistant:write"
    - path: "slack-app-manifest.yml"
      provides: "Assistant event subscriptions"
      contains: "assistant_thread_started"
  key_links:
    - from: "slack-app-manifest.yml"
      to: "Slack API dashboard"
      via: "Manual manifest upload or dashboard config"
      pattern: "assistant_thread"
---

<objective>
Update the Slack app manifest and app constructor to include the assistant:write scope and assistant event subscriptions required for the AI Assistant experience.

Purpose: The assistant panel requires the assistant:write scope and event subscriptions before the Assistant class can receive events.
Output: Updated manifest file and app scopes ready for assistant event handling.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/15-slack-ai-assistant-experience/15-RESEARCH.md
@slack-app-manifest.yml
@apps/slack-backend/src/app.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update manifest and app scopes for assistant</name>
  <files>
    slack-app-manifest.yml
    apps/slack-backend/src/app.ts
  </files>
  <action>
1. Update `slack-app-manifest.yml`:

   a. Add `assistant:write` to `oauth_config.scopes.bot` list:
   ```yaml
   bot:
     - app_mentions:read
     - assistant:write       # NEW: Required for AI assistant panel
     - channels:history
     - channels:read
     - chat:write
     - commands
     - groups:read
     - groups:history
     - im:read
     - im:history
     - mpim:read
     - mpim:history
     - users:read
   ```

   b. Add assistant events to `settings.event_subscriptions.bot_events`:
   ```yaml
   bot_events:
     - app_mention
     - assistant_thread_started           # NEW: When user opens assistant panel
     - assistant_thread_context_changed   # NEW: When user switches channels while in assistant
     - message.channels
     - message.groups
     - message.im
     - message.mpim
   ```

   c. Keep all existing features, shortcuts, slash_commands, etc. unchanged.

2. Update `apps/slack-backend/src/app.ts` â€” add `assistant:write` to the `scopes` array in the App constructor:
   ```typescript
   scopes: [
     'assistant:write',    // NEW: AI assistant panel
     'channels:history',
     'channels:read',
     'chat:write',
     'users:read',
     'app_mentions:read',
     'commands',
     'groups:read',
     'groups:history',
     'im:read',
     'im:history',
     'mpim:read',
     'mpim:history',
   ],
   ```

   Note: This file is also modified by 15-01 (import change). If running in parallel, the import change from 15-01 and the scope change from this plan touch different lines and should merge cleanly. If running sequentially after 15-01, the import will already be updated.
  </action>
  <verify>
`grep 'assistant:write' slack-app-manifest.yml` returns a match. `grep 'assistant_thread_started' slack-app-manifest.yml` returns a match. `grep 'assistant:write' apps/slack-backend/src/app.ts` returns a match.
  </verify>
  <done>
Manifest file and app constructor both include assistant:write scope and assistant event subscriptions.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Updated Slack app manifest with assistant:write scope and assistant event subscriptions. The user needs to apply these changes in the Slack app dashboard.</what-built>
  <how-to-verify>
1. Go to https://api.slack.com/apps and select your Speak for Me app
2. Navigate to "Settings" > "App Manifest" in the sidebar
3. Either paste the updated manifest YAML or make the following changes manually:
   a. Go to "OAuth & Permissions" > "Scopes" > add `assistant:write` to Bot Token Scopes
   b. Go to "Event Subscriptions" > "Subscribe to bot events" > add:
      - `assistant_thread_started`
      - `assistant_thread_context_changed`
   c. Go to "Agents & AI Apps" (may be under "Features") and enable "Agents & AI Apps"
4. Click "Save Changes" and reinstall the app to your workspace if prompted
5. Verify the app now shows "Agents & AI Apps" as enabled in the dashboard

Note: After adding the `assistant:write` scope, you'll need to reinstall the app to grant the new permission. Click the "Reinstall to Workspace" button on the "Install App" page.
  </how-to-verify>
  <resume-signal>Type "approved" when the Slack dashboard is configured and the app is reinstalled, or describe any issues.</resume-signal>
</task>

</tasks>

<verification>
1. `grep -c 'assistant:write' slack-app-manifest.yml` returns 1
2. `grep -c 'assistant_thread_started' slack-app-manifest.yml` returns 1
3. `grep -c 'assistant_thread_context_changed' slack-app-manifest.yml` returns 1
4. User confirms Slack dashboard is configured
</verification>

<success_criteria>
- Manifest includes assistant:write scope and assistant event subscriptions
- App constructor scopes array includes assistant:write
- Slack app dashboard has Agents and AI Apps enabled
- App reinstalled to workspace with new permissions
</success_criteria>

<output>
After completion, create `.planning/phases/15-slack-ai-assistant-experience/15-02-SUMMARY.md`
</output>
