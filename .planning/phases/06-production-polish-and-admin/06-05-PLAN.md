---
phase: 06-production-polish-and-admin
plan: 05
type: execute
wave: 3
depends_on: ["06-03"]
files_modified:
  - apps/web-portal/app/dashboard/feedback/page.tsx
  - apps/web-portal/components/dashboard/feedback-list.tsx
autonomous: true

must_haves:
  truths:
    - "AI Learning tab shows accepted count separately from refined count"
    - "Feedback list shows action type (Accepted/Refined) with icon"
    - "Each feedback entry shows timestamp"
  artifacts:
    - path: "apps/web-portal/app/dashboard/feedback/page.tsx"
      provides: "Enhanced stats with accepted vs refined"
      contains: "getSuggestionFeedbackStats"
    - path: "apps/web-portal/components/dashboard/feedback-list.tsx"
      provides: "Feedback list with action badges"
      contains: "action"
  key_links:
    - from: "apps/web-portal/app/dashboard/feedback/page.tsx"
      to: "lib/db/queries.ts"
      via: "getSuggestionFeedback query"
      pattern: "getSuggestionFeedback"
---

<objective>
Enhance AI Learning tab to show accurate feedback types with timestamps

Purpose: The current AI Learning tab only shows refinements and lacks timestamps. Users need to see both accepted and refined suggestions to understand how they're using AI, with clear timestamps for each interaction.

Output: Updated feedback page showing stats for accepted vs refined, with action badges and timestamps on each entry.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-production-polish-and-admin/06-03-PLAN.md
@apps/web-portal/app/dashboard/feedback/page.tsx
@apps/web-portal/components/dashboard/feedback-list.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update feedback page with acceptance stats</name>
  <files>apps/web-portal/app/dashboard/feedback/page.tsx</files>
  <action>
  Update the AI Learning page to show both accepted and refined statistics:

  1. Import new queries:
     ```typescript
     import {
       getRefinementFeedback,
       getFeedbackStats,
       getMessageCount,
       getSuggestionFeedback,
       getSuggestionFeedbackStats
     } from '@/lib/db/queries';
     ```

  2. Fetch suggestion feedback data:
     ```typescript
     const [
       feedbackItems,
       feedbackStats,
       messageCount,
       suggestionFeedback,
       suggestionStats
     ] = await Promise.all([
       getRefinementFeedback(),
       getFeedbackStats(),
       getMessageCount(),
       getSuggestionFeedback(),
       getSuggestionFeedbackStats(),
     ]);
     ```

  3. Calculate acceptance vs refinement stats:
     ```typescript
     const acceptedCount = suggestionStats.find(s => s.action === 'accepted')?.count || 0;
     const refinedCount = suggestionStats.find(s => s.action === 'refined')?.count || 0;
     const dismissedCount = suggestionStats.find(s => s.action === 'dismissed')?.count || 0;
     const totalInteractions = acceptedCount + refinedCount + dismissedCount;
     ```

  4. Update the stats cards section:
     ```tsx
     <div className="grid gap-4 md:grid-cols-4">
       <StatCard
         title="Messages Analyzed"
         value={messageCount}
         description="For style learning"
         icon={Sparkles}
       />
       <StatCard
         title="Suggestions Accepted"
         value={acceptedCount}
         description="Used as-is"
         icon={Check}
       />
       <StatCard
         title="Suggestions Refined"
         value={refinedCount}
         description="Modified before use"
         icon={TrendingUp}
       />
       <StatCard
         title="Suggestions Dismissed"
         value={dismissedCount}
         description="Not used"
         icon={X}
       />
     </div>
     ```

  5. Import Check and X icons from lucide-react.

  6. Update the "Recent Refinements" card to "Recent Suggestions" showing both accepted and refined:
     ```tsx
     <Card>
       <CardHeader>
         <CardTitle>Recent Suggestions</CardTitle>
         <CardDescription>
           {suggestionFeedback.length === 0
             ? 'No suggestions yet'
             : `${suggestionFeedback.length} interactions recorded`}
         </CardDescription>
       </CardHeader>
       <CardContent>
         {suggestionFeedback.length === 0 ? (
           <EmptyState
             icon={Sparkles}
             title="No suggestions yet"
             description="When you receive AI suggestions in Slack, they'll appear here."
           />
         ) : (
           <FeedbackList feedbackItems={suggestionFeedback} />
         )}
       </CardContent>
     </Card>
     ```
  </action>
  <verify>
  - Build succeeds: `npm run build --workspace=@slack-speak-for-me/web-portal`
  - Page renders without errors
  </verify>
  <done>
  AI Learning page shows separate stats for accepted, refined, and dismissed suggestions
  </done>
</task>

<task type="auto">
  <name>Task 2: Update feedback list component with action badges and timestamps</name>
  <files>apps/web-portal/components/dashboard/feedback-list.tsx</files>
  <action>
  Update FeedbackList component to handle suggestion feedback with action types:

  1. Update the interface to accept suggestion feedback:
     ```typescript
     interface FeedbackItem {
       id: string;
       action?: string; // 'accepted' | 'refined' | 'dismissed'
       suggestionId?: string;
       originalText?: string | null;
       finalText?: string | null;
       modifiedText?: string | null; // For backward compatibility with refinementFeedback
       refinementType?: string | null;
       createdAt: Date | null;
     }
     ```

  2. Create action badge component:
     ```tsx
     function ActionBadge({ action }: { action: string }) {
       const badges: Record<string, { label: string; className: string; icon: LucideIcon }> = {
         accepted: { label: 'Accepted', className: 'bg-green-100 text-green-700', icon: Check },
         refined: { label: 'Refined', className: 'bg-blue-100 text-blue-700', icon: RefreshCw },
         dismissed: { label: 'Dismissed', className: 'bg-gray-100 text-gray-600', icon: X },
       };

       const badge = badges[action] || badges.refined;
       const Icon = badge.icon;

       return (
         <span className={`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${badge.className}`}>
           <Icon className="h-3 w-3" />
           {badge.label}
         </span>
       );
     }
     ```

  3. Update the list rendering to show:
     - Action badge (if action exists)
     - Timestamp with formatDistanceToNow
     - Original text (truncated)
     - Final text if different (showing the change)

     ```tsx
     {feedbackItems.map((item) => (
       <div key={item.id} className="border-b last:border-0 py-4">
         <div className="flex items-center justify-between mb-2">
           {item.action && <ActionBadge action={item.action} />}
           {item.createdAt && (
             <span className="text-xs text-muted-foreground">
               {formatDistanceToNow(item.createdAt, { addSuffix: true })}
             </span>
           )}
         </div>

         <div className="space-y-2">
           <div>
             <span className="text-xs text-muted-foreground">Original:</span>
             <p className="text-sm text-foreground line-clamp-2">
               {item.originalText || 'N/A'}
             </p>
           </div>

           {item.action === 'refined' && item.finalText && item.finalText !== item.originalText && (
             <div>
               <span className="text-xs text-muted-foreground">Refined to:</span>
               <p className="text-sm text-foreground line-clamp-2">
                 {item.finalText}
               </p>
             </div>
           )}
         </div>
       </div>
     ))}
     ```

  4. Import Check, RefreshCw, X from lucide-react and formatDistanceToNow from date-fns.
  </action>
  <verify>
  - Build succeeds: `npm run build --workspace=@slack-speak-for-me/web-portal`
  - Component renders feedback items with badges and timestamps
  </verify>
  <done>
  Feedback list shows action badges (Accepted/Refined/Dismissed) with relative timestamps for each entry
  </done>
</task>

</tasks>

<verification>
1. Build succeeds: `npm run build --workspace=@slack-speak-for-me/web-portal`
2. AI Learning page shows 4 stat cards (Messages, Accepted, Refined, Dismissed)
3. Recent Suggestions list shows action badges and timestamps
</verification>

<success_criteria>
- Stats section shows accepted, refined, and dismissed counts separately
- Each feedback item shows action type badge with appropriate color/icon
- Each feedback item shows "X time ago" timestamp
- Refined items show original and final text
</success_criteria>

<output>
After completion, create `.planning/phases/06-production-polish-and-admin/06-05-SUMMARY.md`
</output>
