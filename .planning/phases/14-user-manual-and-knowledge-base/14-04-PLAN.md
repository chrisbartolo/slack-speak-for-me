---
phase: 14-user-manual-and-knowledge-base
plan: 04
type: execute
wave: 3
depends_on: ["14-02", "14-03"]
files_modified:
  - apps/web-portal/lib/docs/search-index.ts
  - apps/web-portal/app/api/docs/search-index/route.ts
  - apps/web-portal/components/docs/docs-search.tsx
  - apps/web-portal/components/help/help-link.tsx
  - apps/web-portal/app/dashboard/conversations/page.tsx
  - apps/web-portal/app/dashboard/style/page.tsx
  - apps/web-portal/app/dashboard/reports/page.tsx
  - apps/web-portal/app/dashboard/feedback/page.tsx
  - apps/web-portal/app/dashboard/settings/page.tsx
  - apps/web-portal/app/dashboard/billing/page.tsx
  - apps/web-portal/app/dashboard/page.tsx
  - apps/web-portal/components/docs/docs-sidebar.tsx
  - apps/web-portal/components/dashboard/sidebar.tsx
autonomous: true

must_haves:
  truths:
    - "User can search documentation and find relevant articles"
    - "Dashboard pages show contextual help links to relevant documentation"
    - "Search results link to correct documentation pages"
    - "Help links open documentation in new tab"
    - "Documentation sidebar includes a link to Help/Docs from main dashboard"
  artifacts:
    - path: "apps/web-portal/lib/docs/search-index.ts"
      provides: "Search index builder from documentation content"
      exports: ["buildSearchIndex"]
    - path: "apps/web-portal/app/api/docs/search-index/route.ts"
      provides: "API route serving search index JSON"
      exports: ["GET"]
    - path: "apps/web-portal/components/docs/docs-search.tsx"
      provides: "Client-side search component with FlexSearch"
    - path: "apps/web-portal/components/help/help-link.tsx"
      provides: "Contextual help link component for dashboard pages"
  key_links:
    - from: "apps/web-portal/components/docs/docs-search.tsx"
      to: "apps/web-portal/app/api/docs/search-index/route.ts"
      via: "fetch('/api/docs/search-index')"
      pattern: "fetch.*search-index"
    - from: "apps/web-portal/app/dashboard/conversations/page.tsx"
      to: "apps/web-portal/components/help/help-link.tsx"
      via: "HelpLink component import"
      pattern: "HelpLink.*href.*docs/features/watching"
    - from: "apps/web-portal/components/dashboard/sidebar.tsx"
      to: "/docs"
      via: "NavItem link to documentation"
      pattern: "href.*docs"
---

<objective>
Add client-side documentation search and contextual help links throughout the dashboard.

Purpose: This delivers searchable documentation (SC2 knowledge base), in-app help links (SC3), and connects the dashboard to the documentation. Users can find answers without leaving their workflow.
Output: Working FlexSearch-based documentation search. HelpLink component. Help links on all major dashboard pages. Docs link in sidebar.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-user-manual-and-knowledge-base/14-RESEARCH.md
@.planning/phases/14-user-manual-and-knowledge-base/14-01-SUMMARY.md

@apps/web-portal/components/dashboard/sidebar.tsx
@apps/web-portal/app/dashboard/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build search index and search component</name>
  <files>
    apps/web-portal/lib/docs/search-index.ts
    apps/web-portal/app/api/docs/search-index/route.ts
    apps/web-portal/components/docs/docs-search.tsx
    apps/web-portal/components/docs/docs-sidebar.tsx
  </files>
  <action>
    1. Install FlexSearch: `npm install flexsearch --workspace=web-portal`
       If TypeScript types are incomplete, create `apps/web-portal/types/flexsearch.d.ts` with basic type declarations for Document index.

    2. Create `apps/web-portal/lib/docs/search-index.ts`:
       - `buildSearchIndex()`: reads all MDX files using `getAllDocs()` from content.ts
       - For each doc, extract: slug, title, description, category
       - Optionally extract first 200 words of body text (strip MDX/JSX syntax with regex)
       - Return array of `{ slug, title, description, category }` objects
       - This runs server-side only (uses fs module)

    3. Create `apps/web-portal/app/api/docs/search-index/route.ts`:
       - GET handler that calls `buildSearchIndex()` and returns JSON
       - Set Cache-Control header: `public, max-age=3600, s-maxage=3600` (cache for 1 hour)
       - This serves the search index as a JSON API for the client component to fetch

    4. Create `apps/web-portal/components/docs/docs-search.tsx` as a client component ('use client'):
       - Render search input with magnifying glass icon (Search from lucide-react)
       - On first focus or keystroke, lazy-load the search index via `fetch('/api/docs/search-index')`
       - Initialize FlexSearch Document index with fields: title, description
       - Store: title, description, category, slug
       - On input change (debounce 200ms), search the index and show results
       - Results dropdown: show title, description snippet, category badge
       - Each result links to `/docs/${slug}`
       - Close dropdown on click outside or Escape key
       - Show "No results found" for empty searches
       - Keyboard navigation: arrow keys to select, Enter to navigate

    5. Update `apps/web-portal/components/docs/docs-sidebar.tsx`:
       - Add DocsSearch component at the top of the sidebar, above navigation links
       - Ensure search input is always visible in the sidebar
  </action>
  <verify>
    - `npm run build --workspace=web-portal` succeeds
    - `curl http://localhost:3001/api/docs/search-index` returns JSON array of all docs
    - Navigate to /docs, type in search box, see results appear
    - Searching "watch" returns the watching article
    - Searching "billing" returns billing-related articles
    - Clicking a result navigates to the correct article
    - Empty search shows no results message
  </verify>
  <done>
    Documentation search works. FlexSearch index loads lazily on first interaction. Search results show title, description, and category. Results link to correct documentation pages. Search is integrated into the docs sidebar.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add contextual help links to dashboard pages and docs link to sidebar</name>
  <files>
    apps/web-portal/components/help/help-link.tsx
    apps/web-portal/app/dashboard/conversations/page.tsx
    apps/web-portal/app/dashboard/style/page.tsx
    apps/web-portal/app/dashboard/reports/page.tsx
    apps/web-portal/app/dashboard/feedback/page.tsx
    apps/web-portal/app/dashboard/settings/page.tsx
    apps/web-portal/app/dashboard/billing/page.tsx
    apps/web-portal/app/dashboard/page.tsx
    apps/web-portal/components/dashboard/sidebar.tsx
  </files>
  <action>
    1. Create `apps/web-portal/components/help/help-link.tsx`:
       - Props: `href: string` (docs path), `label?: string` (tooltip text, default "Learn more")
       - Render: small HelpCircle icon (lucide-react) as a link
       - Link opens in new tab (`target="_blank"`)
       - Style: text-muted-foreground, hover:text-foreground, inline-flex with gap-1
       - Wrap in Tooltip from shadcn/ui (use TooltipProvider, TooltipTrigger, TooltipContent)
       - Show label text in tooltip on hover
       - Accessible: sr-only span with label text

    2. Add HelpLink to each dashboard page header area. For each page, import HelpLink and place it next to the page title. The existing pages use h1 or heading elements -- add the HelpLink inline after the title text.

       Dashboard page mappings (page -> docs path -> label):
       - `/dashboard/page.tsx` -> `/docs/getting-started/onboarding` -> "Getting started guide"
       - `/dashboard/conversations/page.tsx` -> `/docs/features/watching` -> "Learn about watching conversations"
       - `/dashboard/style/page.tsx` -> `/docs/features/style-settings` -> "Learn about style settings"
       - `/dashboard/reports/page.tsx` -> `/docs/features/reports` -> "Learn about weekly reports"
       - `/dashboard/feedback/page.tsx` -> `/docs/features/suggestions` -> "Learn about AI suggestions"
       - `/dashboard/settings/page.tsx` -> `/docs/admin/compliance` -> "Learn about data & privacy"
       - `/dashboard/billing/page.tsx` -> `/docs/admin/billing` -> "Learn about billing"

       For each page:
       - Read the existing page file first
       - Find the main heading/title element
       - Add HelpLink component next to or below the title
       - Wrap title + HelpLink in a flex container if needed for alignment
       - Ensure the help link does NOT interfere with existing layout
       - Use subtle styling so it is present but not visually dominant

    3. Update `apps/web-portal/components/dashboard/sidebar.tsx`:
       - Import `BookOpen` icon from lucide-react
       - Add a new NavItem for documentation: `<NavItem href="/docs" icon={BookOpen} label="Help & Docs" />`
       - Place it after the existing navigation items, before the admin section divider
       - This gives users quick access to documentation from anywhere in the dashboard
  </action>
  <verify>
    - `npm run build --workspace=web-portal` succeeds
    - Navigate to /dashboard and see help link icon next to the title
    - Click help link on any dashboard page -- opens docs article in new tab
    - Hover over help link -- tooltip shows descriptive label
    - Sidebar shows "Help & Docs" link
    - Click "Help & Docs" in sidebar -- navigates to /docs landing page
    - Help links do not break existing page layout
    - All 7 dashboard pages have contextual help links
  </verify>
  <done>
    In-app help links complete. HelpLink component created. All 7 major dashboard pages have contextual help icons linking to relevant documentation. Sidebar includes "Help & Docs" navigation item. Help links open in new tab with descriptive tooltips.
  </done>
</task>

</tasks>

<verification>
1. Documentation search works from docs sidebar
2. Search finds articles by title and description keywords
3. HelpLink component renders correctly with tooltip
4. All 7 dashboard pages have contextual help links
5. Help links point to correct documentation articles
6. Sidebar shows "Help & Docs" link to /docs
7. `npm run build --workspace=web-portal` succeeds
8. No layout regressions on any dashboard page
</verification>

<success_criteria>
- FlexSearch-based search finds documentation articles by keyword
- Search index loads lazily (no performance impact on initial page load)
- All major dashboard pages have contextual help links to relevant docs
- Help links open in new tab with accessible tooltips
- Sidebar provides quick access to documentation via "Help & Docs" link
- No regressions to existing dashboard layout or functionality
</success_criteria>

<output>
After completion, create `.planning/phases/14-user-manual-and-knowledge-base/14-04-SUMMARY.md`
</output>
