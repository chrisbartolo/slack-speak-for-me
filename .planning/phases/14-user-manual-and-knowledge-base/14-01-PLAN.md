---
phase: 14-user-manual-and-knowledge-base
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web-portal/package.json
  - apps/web-portal/source.config.ts
  - apps/web-portal/lib/source.ts
  - apps/web-portal/next.config.ts
  - apps/web-portal/tsconfig.json
  - apps/web-portal/app/globals.css
  - apps/web-portal/app/layout.tsx
  - apps/web-portal/app/(docs)/layout.tsx
  - apps/web-portal/app/(docs)/docs/layout.tsx
  - apps/web-portal/app/(docs)/docs/[[...slug]]/page.tsx
  - apps/web-portal/app/(docs)/docs/api/search/route.ts
  - apps/web-portal/content/docs/index.mdx
  - apps/web-portal/content/docs/meta.json
  - .gitignore
autonomous: true

must_haves:
  truths:
    - "Navigating to /docs renders a documentation page with sidebar and search"
    - "Existing app pages (/, /dashboard, /pricing, /admin) still work unchanged"
    - "MDX content in content/docs/ renders with proper styling"
    - "Search API at /docs/api/search returns results"
  artifacts:
    - path: "apps/web-portal/source.config.ts"
      provides: "Fumadocs MDX collection definitions"
      contains: "defineDocs"
    - path: "apps/web-portal/lib/source.ts"
      provides: "Fumadocs source loader"
      contains: "loader"
    - path: "apps/web-portal/app/(docs)/layout.tsx"
      provides: "Docs root layout with RootProvider"
      contains: "RootProvider"
    - path: "apps/web-portal/app/(docs)/docs/layout.tsx"
      provides: "DocsLayout with sidebar and navigation"
      contains: "DocsLayout"
    - path: "apps/web-portal/app/(docs)/docs/[[...slug]]/page.tsx"
      provides: "Dynamic MDX page renderer"
      contains: "generateStaticParams"
    - path: "apps/web-portal/app/(docs)/docs/api/search/route.ts"
      provides: "Orama-based search API"
      contains: "createFromSource"
  key_links:
    - from: "apps/web-portal/lib/source.ts"
      to: "@/.source"
      via: "import from auto-generated .source directory"
      pattern: "from '@/\\.source'"
    - from: "apps/web-portal/app/(docs)/docs/[[...slug]]/page.tsx"
      to: "apps/web-portal/lib/source.ts"
      via: "source.getPage for MDX rendering"
      pattern: "source\\.getPage"
    - from: "apps/web-portal/next.config.ts"
      to: "fumadocs-mdx/next"
      via: "createMDX wrapping next config"
      pattern: "createMDX"
---

<objective>
Install Fumadocs framework and set up documentation infrastructure with route groups, MDX rendering, sidebar navigation, and search.

Purpose: This is the foundation for all documentation. Without the Fumadocs infrastructure, no docs pages can render. The route group architecture ensures the existing app is completely unaffected.
Output: Working /docs route with Fumadocs sidebar, search, and a placeholder index page proving the pipeline works.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-user-manual-and-knowledge-base/14-RESEARCH.md
@apps/web-portal/package.json
@apps/web-portal/next.config.ts
@apps/web-portal/tsconfig.json
@apps/web-portal/app/layout.tsx
@apps/web-portal/app/globals.css
@apps/web-portal/middleware.ts
@.gitignore
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Fumadocs packages and configure build pipeline</name>
  <files>
    apps/web-portal/package.json
    apps/web-portal/source.config.ts
    apps/web-portal/lib/source.ts
    apps/web-portal/next.config.ts
    apps/web-portal/tsconfig.json
    apps/web-portal/app/globals.css
    .gitignore
  </files>
  <action>
    1. Install Fumadocs packages in web-portal workspace:
       `npm install fumadocs-core fumadocs-ui fumadocs-mdx @types/mdx --workspace=web-portal`

    2. Create `apps/web-portal/source.config.ts`:
       - Import `defineDocs`, `defineConfig` from `fumadocs-mdx/config`
       - Export `docs` collection with `dir: 'content/docs'`
       - Export default `defineConfig()`
       - Keep frontmatter schema simple (use defaults -- title, description come built-in)

    3. Create `apps/web-portal/lib/source.ts`:
       - Import `docs` and `meta` from `@/.source`
       - Import `loader` from `fumadocs-core/source`
       - Export `source = loader({ baseUrl: '/docs', source: docs.toFumadocsSource() })`

    4. Update `apps/web-portal/next.config.ts`:
       - Add `import { createMDX } from 'fumadocs-mdx/next'` at top
       - Create `const withMDX = createMDX()`
       - Change export to `export default withMDX(nextConfig)` (wrapping existing config)
       - Keep ALL existing security headers and config intact

    5. Update `apps/web-portal/tsconfig.json`:
       - Add `"@/.source": ["./.source"]` to the `paths` object alongside existing `"@/*": ["./*"]`

    6. Update `apps/web-portal/app/globals.css`:
       - Add `@source '../node_modules/fumadocs-ui/dist/**/*.js';` AFTER the existing `@import "tw-animate-css";` line
       - This tells Tailwind v4 to scan Fumadocs distribution files for utility classes
       - Do NOT import fumadocs CSS files here -- they go in the docs layout only

    7. Add `postinstall` script to `apps/web-portal/package.json`:
       - Add `"postinstall": "fumadocs-mdx"` to scripts section

    8. Update root `.gitignore`:
       - Add `# Fumadocs MDX generated files` comment
       - Add `.source/` entry
       - Also add `apps/web-portal/.source/` for explicitness

    9. Run `npm install` from monorepo root to trigger postinstall and generate .source directory.
       If postinstall fails from root, try `cd apps/web-portal && npx fumadocs-mdx` as fallback.
  </action>
  <verify>
    - `ls apps/web-portal/node_modules/fumadocs-core` confirms package installed
    - `ls apps/web-portal/.source/` confirms generated directory exists (may need content first)
    - `cat apps/web-portal/source.config.ts` shows defineDocs export
    - `cat apps/web-portal/next.config.ts` shows createMDX wrapper
  </verify>
  <done>
    Fumadocs packages installed, source config created, next.config wrapped with createMDX, tsconfig has .source path alias, globals.css has @source directive, .gitignore excludes .source directory.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create docs route group with layouts, dynamic page, and search</name>
  <files>
    apps/web-portal/app/(docs)/layout.tsx
    apps/web-portal/app/(docs)/docs/layout.tsx
    apps/web-portal/app/(docs)/docs/[[...slug]]/page.tsx
    apps/web-portal/app/(docs)/docs/api/search/route.ts
    apps/web-portal/content/docs/index.mdx
    apps/web-portal/content/docs/meta.json
    apps/web-portal/app/layout.tsx
    apps/web-portal/middleware.ts
  </files>
  <action>
    1. Create `apps/web-portal/app/(docs)/layout.tsx`:
       - This is the docs root layout with Fumadocs RootProvider scoped to docs only
       - Import `RootProvider` from `fumadocs-ui/provider/next`
       - Import `fumadocs-ui/css/neutral.css` and `fumadocs-ui/css/preset.css`
       - Render: `<RootProvider>{children}</RootProvider>` (NO html/body tags -- those come from root layout)
       - CRITICAL: Do NOT add html/body here. The shared root layout.tsx already provides those.
         Since this is a route group (not a separate root layout), it nests inside the root layout.

    2. Create `apps/web-portal/app/(docs)/docs/layout.tsx`:
       - Import `DocsLayout` from `fumadocs-ui/layouts/docs`
       - Import `source` from `@/lib/source`
       - Render: `<DocsLayout tree={source.pageTree} nav={{ title: 'Speak for Me Docs' }}>{children}</DocsLayout>`

    3. Create `apps/web-portal/app/(docs)/docs/[[...slug]]/page.tsx`:
       - Import `source` from `@/lib/source`
       - Import `DocsPage`, `DocsBody`, `DocsTitle`, `DocsDescription` from `fumadocs-ui/layouts/docs/page`
       - Import `defaultMdxComponents` from `fumadocs-ui/mdx`
       - Import `notFound` from `next/navigation`
       - Implement async Page component:
         * Get params (await props.params)
         * Get page via `source.getPage(params.slug)`
         * If not found, call notFound()
         * Get MDX body: `const MDX = page.data.body`
         * Render DocsPage with toc={page.data.toc}, DocsTitle, DocsDescription, DocsBody with MDX
       - Export `generateStaticParams` calling `source.generateParams()`
       - Export `generateMetadata` returning title and description from page data

    4. Create `apps/web-portal/app/(docs)/docs/api/search/route.ts`:
       - Import `source` from `@/lib/source`
       - Import `createFromSource` from `fumadocs-core/search/server`
       - Export `const { GET } = createFromSource(source, { language: 'english' })`

    5. Create `apps/web-portal/content/docs/index.mdx`:
       ```mdx
       ---
       title: Speak for Me Documentation
       description: Learn how to use Speak for Me to get AI-powered response suggestions in Slack
       ---

       Welcome to the Speak for Me documentation. This guide covers everything you need to know about using AI-powered response suggestions in your Slack workspace.

       ## Quick Links

       - **Getting Started** - Install and configure Speak for Me
       - **Features** - Learn about watching, suggestions, and refinement
       - **Administration** - Organization setup and team management
       - **Troubleshooting** - Common issues and solutions
       ```

    6. Create `apps/web-portal/content/docs/meta.json`:
       ```json
       {
         "title": "Documentation",
         "pages": [
           "index",
           "---Getting Started---",
           "getting-started",
           "---Features---",
           "features",
           "---Administration---",
           "admin",
           "---Help---",
           "troubleshooting",
           "faq",
           "api"
         ]
       }
       ```

    7. Update `apps/web-portal/middleware.ts`:
       - Add '/docs' to the publicRoutes array so docs pages are accessible without auth
       - The matcher regex should already allow /docs paths through

    8. Verify the existing app pages still work:
       - The existing pages at app/page.tsx, app/dashboard/, app/admin/, app/pricing/, etc.
         continue to work because they are NOT inside a route group -- they remain at their
         current paths. Route groups only affect files INSIDE the parenthesized folder.
       - IMPORTANT: Do NOT move existing pages into a (main) route group. The research
         suggested this, but it is unnecessary and risky. Fumadocs docs can live in
         app/(docs)/ as a route group while existing pages stay at their current locations.
         Next.js resolves routes from all directories under app/ -- route groups just prevent
         their folder name from appearing in the URL.

    9. Run `npm run dev --workspace=web-portal` and verify:
       - http://localhost:3001/docs loads the documentation index page
       - Sidebar navigation appears
       - Existing pages (http://localhost:3001/, http://localhost:3001/pricing) still work
  </action>
  <verify>
    - `npm run build --workspace=web-portal` completes without errors
    - The /docs route renders documentation content with sidebar
    - The /docs/api/search endpoint responds to GET requests
    - Existing routes (/, /pricing, /dashboard) are unaffected
  </verify>
  <done>
    Docs route group exists with RootProvider, DocsLayout, dynamic MDX page renderer, and search API. The /docs route renders the index page with sidebar navigation. All existing app routes continue working unchanged.
  </done>
</task>

</tasks>

<verification>
1. `npm run build --workspace=web-portal` succeeds
2. /docs renders documentation with Fumadocs sidebar and search
3. /, /pricing, /dashboard, /admin routes work unchanged
4. Search API at /docs/api/search responds
5. No CSS variable conflicts between Fumadocs and existing shadcn/ui theme
</verification>

<success_criteria>
- Fumadocs infrastructure fully configured and rendering
- /docs shows index page with sidebar navigation
- Build passes without errors
- Existing app completely unaffected
- Search endpoint operational
</success_criteria>

<output>
After completion, create `.planning/phases/14-user-manual-and-knowledge-base/14-01-SUMMARY.md`
</output>
