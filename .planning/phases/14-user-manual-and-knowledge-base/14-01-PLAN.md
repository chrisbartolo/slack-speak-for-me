---
phase: 14-user-manual-and-knowledge-base
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web-portal/next.config.ts
  - apps/web-portal/mdx-components.tsx
  - apps/web-portal/app/globals.css
  - apps/web-portal/lib/docs/content.ts
  - apps/web-portal/lib/docs/navigation.ts
  - apps/web-portal/app/docs/layout.tsx
  - apps/web-portal/app/docs/page.tsx
  - apps/web-portal/components/docs/docs-layout.tsx
  - apps/web-portal/components/docs/docs-sidebar.tsx
  - apps/web-portal/components/docs/docs-breadcrumb.tsx
  - apps/web-portal/components/docs/docs-toc.tsx
  - apps/web-portal/components/docs/docs-pagination.tsx
  - apps/web-portal/components/docs/callout.tsx
  - apps/web-portal/components/docs/step.tsx
  - apps/web-portal/content/docs/_meta.ts
  - apps/web-portal/content/docs/getting-started/installation.mdx
autonomous: true

must_haves:
  truths:
    - "Visiting /docs shows a documentation landing page with category navigation"
    - "MDX files render with prose typography styling"
    - "Custom Callout and Step components work inside MDX content"
    - "Docs layout has sidebar navigation and content area"
  artifacts:
    - path: "apps/web-portal/next.config.ts"
      provides: "MDX webpack configuration with remark/rehype plugins"
      contains: "createMDX"
    - path: "apps/web-portal/mdx-components.tsx"
      provides: "Root MDX component overrides"
      exports: ["useMDXComponents"]
    - path: "apps/web-portal/lib/docs/content.ts"
      provides: "MDX content loading and frontmatter parsing"
      exports: ["getDocBySlug", "getAllDocSlugs"]
    - path: "apps/web-portal/lib/docs/navigation.ts"
      provides: "Documentation navigation tree builder"
      exports: ["getDocsNavigation"]
    - path: "apps/web-portal/components/docs/docs-layout.tsx"
      provides: "Docs page layout with sidebar and content area"
    - path: "apps/web-portal/components/docs/callout.tsx"
      provides: "Info/Warning/Tip/Danger callout boxes for MDX"
    - path: "apps/web-portal/components/docs/step.tsx"
      provides: "Step-by-step instruction component for MDX"
    - path: "apps/web-portal/content/docs/_meta.ts"
      provides: "Navigation metadata and ordering for docs categories"
  key_links:
    - from: "apps/web-portal/next.config.ts"
      to: "@next/mdx"
      via: "createMDX wrapper around nextConfig"
      pattern: "withMDX\\(nextConfig\\)"
    - from: "apps/web-portal/mdx-components.tsx"
      to: "components/docs/callout.tsx"
      via: "useMDXComponents return object"
      pattern: "Callout"
    - from: "apps/web-portal/app/docs/layout.tsx"
      to: "components/docs/docs-layout.tsx"
      via: "DocsLayout wrapper component"
      pattern: "DocsLayout"
---

<objective>
Set up the MDX documentation infrastructure and docs layout with sidebar navigation, custom components, and a landing page.

Purpose: This is the foundation that all documentation content depends on. Without MDX compilation, content utilities, and the docs layout, no documentation pages can be created or rendered.
Output: Working /docs route with layout, sidebar navigation, custom MDX components (Callout, Step), and one sample article to verify the pipeline.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-user-manual-and-knowledge-base/14-RESEARCH.md

@apps/web-portal/next.config.ts
@apps/web-portal/app/globals.css
@apps/web-portal/mdx-components.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install MDX dependencies and configure Next.js for MDX</name>
  <files>
    apps/web-portal/next.config.ts
    apps/web-portal/mdx-components.tsx
    apps/web-portal/app/globals.css
  </files>
  <action>
    1. Install MDX and documentation dependencies in the web-portal workspace:
       ```
       npm install @next/mdx @mdx-js/loader @mdx-js/react @types/mdx @tailwindcss/typography remark-gfm rehype-slug rehype-autolink-headings gray-matter --workspace=web-portal
       ```

    2. Update `apps/web-portal/next.config.ts`:
       - Import `createMDX` from `@next/mdx`, `remarkGfm` from `remark-gfm`, `rehypeSlug` from `rehype-slug`, `rehypeAutolinkHeadings` from `rehype-autolink-headings`
       - Add `pageExtensions: ['js', 'jsx', 'md', 'mdx', 'ts', 'tsx']` to nextConfig
       - Create `withMDX` using `createMDX({ options: { remarkPlugins: [remarkGfm], rehypePlugins: [rehypeSlug, [rehypeAutolinkHeadings, { behavior: 'wrap' }]] } })`
       - Export `withMDX(nextConfig)` instead of bare `nextConfig`
       - KEEP all existing config (securityHeaders, output, transpilePackages, headers)

    3. Create `apps/web-portal/mdx-components.tsx` (root-level, MANDATORY for @next/mdx):
       - Export `useMDXComponents()` function (no parameters -- Next.js 16 signature)
       - Return object mapping custom components: `Callout`, `Step`
       - Override default elements with styled versions using prose-compatible classes
       - Import Callout from `@/components/docs/callout` and Step from `@/components/docs/step`

    4. Update `apps/web-portal/app/globals.css`:
       - Add `@plugin "@tailwindcss/typography";` after the `@import "tw-animate-css";` line
       - This is the Tailwind v4 way to register plugins (NOT via config file)
       - Do NOT modify any existing CSS variables or styles
  </action>
  <verify>
    - `npm run build --workspace=web-portal` completes without errors (may have warnings about missing components, that is OK at this stage)
    - `apps/web-portal/mdx-components.tsx` exists at the web-portal root
    - `apps/web-portal/next.config.ts` exports `withMDX(nextConfig)` and includes `pageExtensions`
  </verify>
  <done>
    MDX compilation pipeline is configured. next.config.ts wraps config with createMDX. mdx-components.tsx exists at root. Typography plugin registered in globals.css. All existing routes still work (pageExtensions includes ts, tsx).
  </done>
</task>

<task type="auto">
  <name>Task 2: Create content utilities, navigation metadata, docs components, and docs layout</name>
  <files>
    apps/web-portal/lib/docs/content.ts
    apps/web-portal/lib/docs/navigation.ts
    apps/web-portal/content/docs/_meta.ts
    apps/web-portal/components/docs/callout.tsx
    apps/web-portal/components/docs/step.tsx
    apps/web-portal/components/docs/docs-layout.tsx
    apps/web-portal/components/docs/docs-sidebar.tsx
    apps/web-portal/components/docs/docs-breadcrumb.tsx
    apps/web-portal/components/docs/docs-toc.tsx
    apps/web-portal/components/docs/docs-pagination.tsx
    apps/web-portal/app/docs/layout.tsx
    apps/web-portal/app/docs/page.tsx
    apps/web-portal/content/docs/getting-started/installation.mdx
  </files>
  <action>
    1. Create `apps/web-portal/lib/docs/content.ts`:
       - Define `DocMeta` interface: `{ title: string; description: string; category: string; order: number }`
       - `getDocBySlug(slug: string)`: reads MDX file from `content/docs/${slug}.mdx`, parses frontmatter with `gray-matter`, returns `{ slug, meta }` or null
       - `getAllDocSlugs()`: recursively walks `content/docs/` directory, returns array of slug strings (without .mdx extension)
       - `getAllDocs()`: returns all docs with metadata, sorted by category then order
       - Use `path.join(process.cwd(), 'content/docs')` as CONTENT_DIR

    2. Create `apps/web-portal/lib/docs/navigation.ts`:
       - `getDocsNavigation()`: reads _meta.ts and all doc frontmatter to build navigation tree
       - Returns `NavSection[]` where each section has `{ title, slug, items: NavItem[] }`
       - `NavItem` has `{ title, slug, description }`
       - Sort sections and items by `order` from frontmatter

    3. Create `apps/web-portal/content/docs/_meta.ts`:
       - Export `categories` array defining section order and labels:
         - `{ slug: 'getting-started', title: 'Getting Started', order: 1 }`
         - `{ slug: 'features', title: 'Features', order: 2 }`
         - `{ slug: 'admin', title: 'Administration', order: 3 }`
         - `{ slug: 'troubleshooting', title: 'Troubleshooting', order: 4 }`
         - `{ slug: 'api', title: 'API & Integrations', order: 5 }`

    4. Create `apps/web-portal/components/docs/callout.tsx`:
       - Props: `type?: 'info' | 'warning' | 'tip' | 'danger'`, `children: React.ReactNode`
       - Style map: info=blue, warning=yellow, tip=green, danger=red (bg, border, icon, text colors)
       - Icons from lucide-react: Info, AlertTriangle, Lightbulb, AlertCircle
       - Layout: flex with icon + content div, rounded border, 4px padding, my-4 margin

    5. Create `apps/web-portal/components/docs/step.tsx`:
       - Props: `number: number`, `children: React.ReactNode`
       - Render numbered circle (gradient bg matching brand) with step content beside it
       - Use flex layout with number badge and content div

    6. Create `apps/web-portal/components/docs/docs-sidebar.tsx`:
       - Client component ('use client') for active state tracking
       - Receives `navigation: NavSection[]` as prop
       - Renders collapsible sections with category titles and article links
       - Highlight active link using `usePathname()` from next/navigation
       - Style consistent with existing sidebar (border-r, bg-background)
       - Include a link to /docs at top ("Documentation Home")

    7. Create `apps/web-portal/components/docs/docs-breadcrumb.tsx`:
       - Client component using `usePathname()`
       - Parse path segments to build breadcrumb trail: Docs > Category > Article
       - Use category titles from navigation metadata
       - Use `>` or `/` separators, link each segment

    8. Create `apps/web-portal/components/docs/docs-toc.tsx`:
       - Client component for table of contents (right sidebar on large screens)
       - Accept `headings: { id: string; text: string; level: number }[]` prop
       - Render nested list of heading links with scroll-to behavior
       - Show on lg+ screens, hidden on mobile
       - Track active heading via IntersectionObserver for scroll position highlighting

    9. Create `apps/web-portal/components/docs/docs-pagination.tsx`:
       - Props: `prev?: { title: string; slug: string }`, `next?: { title: string; slug: string }`
       - Render Previous/Next navigation links at bottom of article
       - Use arrow icons from lucide-react, flex layout with justify-between

    10. Create `apps/web-portal/components/docs/docs-layout.tsx`:
        - Server component wrapping docs pages
        - 3-column layout on lg+: sidebar (w-64) | content (flex-1, max-w-3xl) | TOC (w-48)
        - 1-column on mobile with hamburger/drawer for sidebar
        - Fetch navigation data and pass to sidebar
        - Apply `prose` classes to content area for typography

    11. Create `apps/web-portal/app/docs/layout.tsx`:
        - Import DocsLayout component
        - Set metadata: title template `%s | Speak for Me Docs`, description
        - Wrap children in DocsLayout

    12. Create `apps/web-portal/app/docs/page.tsx`:
        - Documentation landing page
        - Show category cards linking to first article in each category
        - Brief intro text explaining what docs cover
        - Styled with brand colors (gradient accents)

    13. Create one sample article to verify the full pipeline:
        `apps/web-portal/content/docs/getting-started/installation.mdx`
        - Frontmatter: title "Installing Speak for Me", description, category "getting-started", order 1
        - Content: Brief installation guide with Step components showing how to add the app to Slack
        - Include a Callout component to verify custom components render
        - Include a table and heading to verify remark-gfm and rehype-slug work
  </action>
  <verify>
    - `npm run build --workspace=web-portal` succeeds
    - Navigate to http://localhost:3001/docs and see the landing page with category cards
    - Navigate to http://localhost:3001/docs/getting-started/installation and see the rendered MDX article with:
      - Prose typography applied (headings, paragraphs styled)
      - Callout component rendering with icon and colored background
      - Step component rendering with numbered circle
      - Table rendering (from remark-gfm)
      - Heading anchor links (from rehype-slug + rehype-autolink-headings)
    - Sidebar navigation shows "Getting Started" section with "Installing Speak for Me" link
    - Breadcrumb shows: Docs > Getting Started > Installing Speak for Me
  </verify>
  <done>
    Docs infrastructure is complete. /docs landing page renders. Sample MDX article at /docs/getting-started/installation renders with prose typography, custom Callout/Step components, sidebar navigation, breadcrumbs, and table of contents. All existing routes still work.
  </done>
</task>

</tasks>

<verification>
1. `npm run build --workspace=web-portal` passes without errors
2. /docs page loads with category navigation
3. /docs/getting-started/installation renders MDX with prose styling
4. Custom Callout and Step components render inside MDX
5. Sidebar navigation is functional with active link highlighting
6. All existing routes (/dashboard, /pricing, etc.) still work
7. No pageExtensions-related 404 errors
</verification>

<success_criteria>
- MDX pipeline configured: next.config.ts wraps with createMDX, mdx-components.tsx at root, typography plugin registered
- Content utilities working: getDocBySlug, getAllDocSlugs, getDocsNavigation return correct data
- Docs layout renders: 3-column on desktop (sidebar, content, TOC), responsive on mobile
- Custom MDX components work: Callout and Step render correctly inside MDX files
- Sample article verifies full pipeline: frontmatter parsed, prose styled, plugins active
- No regressions: existing routes unaffected
</success_criteria>

<output>
After completion, create `.planning/phases/14-user-manual-and-knowledge-base/14-01-SUMMARY.md`
</output>
